# 가상 메모리

# 개요

다중 프로그래밍을 실현하기 위해서는 많은 프로세스들을 동시에 메모리에 올려두어야 한다. 가상 메모리는 프로세스 전체가 메모리 내에 올라오지 않더라도 실행이 가능하도록 하는 기법이며, 프로그램이 물리 메모리보다 커도 된다는 주요 장점이 있다.

# 가상 메모리의 등장 배경

과거에는 실행되는 코드 전체를 물리 메모리에 적재해야 했고, 메모리 용량보다 큰 프로그램은 실행시킬 수 없었다. 또한, 여러 프로그램을 동시에 메모리에 올리기에는 물리 메모리 용량 한계와 페이지 교체 등의 성능 이슈가 동반된다.

무엇보다도 특정 서비스 사용을 위해 어떤 프로그램을 실행하였을 때, 그 특정 서비스와 관련이 없는 코드까지 메모리에 적재하는 것은 불필요하다는 것이다. 프로그램의 일부분만 메모리에 올릴 수 있다면 다음과 같은 장점을 취할 수 있다.

- 물리 메모리 크기에 제약을 받지 않는다.
- 더 많은 프로그램을 동시에 실행할 수 있다. 이에 따라 응답시간은 유지되고, CPU 이용률과 처리율은 높아진다.
- Swap에 필요한 입출력이 줄어들기 때문에 프로그램들이 더 빠르게 실행된다.

이러한 배경에 따라 가상 메모리 개념이 등장하였다. 

# 가상 메모리의 상세 개념

가상 메모리는 실제의 물리 메모리 개념과 사용자의 논리 메모리 개념을 구분한 것이다. 가상 메모리를 사용하면 프로그래머는 애플리케이션 개발 시 애플리케이션에 필요한 가상 주소 공간을 제공받으며, 여유 물리 메모리에 크게 구애받지 않고 개발에 집중할 수 있다.

### 가상 주소 공간

- 한 프로세스가 메모리에 저장되는 논리적인 모습을 가상 메모리에 구현한 공간이다. 프로세스가 요구하는 메모리 공간을 가상 메모리 공간으로 제공함으로써 실시간으로 필요한 논리 메모리 공간만 물리 메모리에 적재하여 사용함으로써 물리 메모리를 절약할 수 있다.
- 예를 들어, 한 프로그램의 정상적인 구동 및 작동에 100KB의 논리 메모리가 요구된다고 가정한다. 하지만 단순히 실행에 필요한 메모리 공간(Heap, Stack, Code, Data)의 합이 40KB라면, 실제 물리 메모리에는 당장 필요한 40KB만 적재하고, 나머지 60KB는 필요 시에 추가로 물리 메모리에 적재한다.

### 가상 메모리의 특징

- 시스템 라이브러리를 프로세스가 공유하여 사용할 수 있도록 한다. 각 프로세스는 공유된 시스템 라이브러리를 자신의 가상 주소 공간에 두고 사용하는 것처럼 인식하지만, 실제로는 시스템 라이브러리가 점유하는 물리 메모리 페이지는 모든 프로세스에게 공유하고 있다.
- 프로세스들이 메모리를 공유하는 것을 가능하게 하고, 프로세스들은 공유 메모리를 통해 통신할 수 있다. 공유 메모리도 시스템 라이브러리와 마찬가지로 각각의 프로세스는 자신의 주소 공간에 포함된 것처럼 인식하지만, 실제 공유 메모리가 점유하는 물리 메모리는 모든 프로세스에게 공유하고 있다.
- `fork()`를 통한 프로세스 생성 과정에서 페이지들을 공유하는 것을 가능하게 한다.

### 요구 페이징(Demand Paging)

프로그램 실행 시작 시에 프로그램 전체를 디스크에서 물리 메모리에 적재하는 대신, 초기에 필요한 것들만 적재하는 전략을 `요구 페이징(Demand Paging)`이라 하며, 가상 메모리 시스템에서 많이 사용된다. 그리고 가상 메모리는 대개 `페이지`로 관리된다. 요구 페이징을 사용하는 가상 메모리에서는 실행 과정에서 필요할 때 페이지들을 물리 메모리에 적재한다. 한 번도 접근하지 않은(필요하지 않은) 페이지는 물리 메모리에 적재되지 않는다.

프로세스 내의 개별 페이지들은 `페이저(Pager)`가 관리한다. 페이저는 프로세스 실행에 필요한 페이지들만 물리 메모리에 적재하여 당장 필요하지 않은 페이지를 적재함으로써 발생하는 시간 및 메모리 낭비를 줄인다.

[[OS기초] 메모리 관리(가상 메모리, 페이지 부재, 페이지 교채, 스레싱)](https://velog.io/@adam2/OS%EA%B8%B0%EC%B4%88-%EB%A9%94%EB%AA%A8%EB%A6%AC-%EA%B4%80%EB%A6%AC%EA%B0%80%EC%83%81-%EB%A9%94%EB%AA%A8%EB%A6%AC-%ED%8E%98%EC%9D%B4%EC%A7%80-%EB%B6%80%EC%9E%AC-%ED%8E%98%EC%9D%B4%EC%A7%80-%EA%B5%90%EC%B1%84-%EC%8A%A4%EB%A0%88%EC%8B%B1)

[가상메모리(virtual memory)와 요구페이징(demand paging)](https://seungahyoo.tistory.com/70)

[[운영체제] 9장 가상메모리](https://blog.naver.com/PostView.nhn?blogId=yeop9657&logNo=220729107141&parentCategoryNo=&categoryNo=123&viewDate=&isShowPopularPosts=true&from=search)